<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ report_title }}</title>
</head>
<body style="font-family: Arial, sans-serif; margin:0; padding:20px; background:#f5f5f5;">
<div style="max-width:1100px; margin:0 auto; background:white; padding:20px; border-radius:8px;">

    <!-- Header and Date -->
    <div style="text-align:center; color:#333; padding-bottom:10px; font-size:18px;">
        <strong>{{ report_title }}</strong>
    </div>
    <div style="text-align:center; color:#555; margin-bottom:26px;">
        Monday, July 21, 2025, 4:56 PM IST
    </div>

    <!-- SUMMARY CARDS -->
    <div style="display:flex; justify-content:space-between; margin-bottom:30px; gap:18px;">
        <div style="flex:1; padding:20px 0; border-radius:6px; text-align:center; background:#28a745; color:white;">
            <div style="font-size:32px; font-weight: bold; line-height:1">{{ report_data | selectattr('status', 'equalto', 'HEALTHY') | list | length }}</div>
            <div style="margin-top:4px;">Healthy Hosts</div>
        </div>
        <div style="flex:1; padding:20px 0; border-radius:6px; text-align:center; background:#dc3545; color:white;">
            <div style="font-size:32px; font-weight: bold; line-height:1">{{ report_data | selectattr('status', 'equalto', 'CRITICAL') | list | length }}</div>
            <div style="margin-top:4px;">Critical Hosts</div>
        </div>
        <div style="flex:1; padding:20px 0; border-radius:6px; text-align:center; background:#17a2b8; color:white;">
            <div style="font-size:32px; font-weight: bold; line-height:1">{{ report_data | map(attribute='healthy_containers') | list | flatten | length }}</div>
            <div style="margin-top:4px;">Running Containers</div>
        </div>
        <div style="flex:1; padding:20px 0; border-radius:6px; text-align:center; background:#ffc107; color:#212529;">
            <div style="font-size:32px; font-weight: bold; line-height:1;">
            {{
                (report_data | map(attribute='down_containers') | list | flatten | length)
                + (report_data | map(attribute='missing_containers') | list | flatten | length)
            }}</div>
            <div style="margin-top:4px;">Problem Containers</div>
        </div>
    </div>

    {% for host_data in report_data | sort(attribute='status', reverse=true) %}
    {% set status_color = "#28a745" if host_data.status == "HEALTHY" else "#dc3545" %}
    {% set text_color = "white" %}
    <div style="background:{{ status_color }}; color:{{ text_color }}; padding:13px 17px; font-size:18px; font-weight:bold; border-radius:5px 5px 0 0; margin-bottom:0;">
        {{ host_data.host.upper() }}
        <span style="float:right;">
            {{ host_data.component_type | title }} - {{ host_data.status }}
        </span>
    </div>
    <table style="width:100%; border-collapse:separate; border-spacing:0; margin-bottom:35px;">
        <thead>
            <tr>
                <th style="padding:10px 14px; text-align:left; background:#f8f9fa; font-size:15px;">Container Name</th>
                <th style="padding:10px 14px; text-align:left; background:#f8f9fa; font-size:15px;">Status</th>
                <th style="padding:10px 14px; text-align:left; background:#f8f9fa; font-size:15px;">Start Time</th>
            </tr>
        </thead>
        <tbody>
        {% for container in host_data.containers %}
            <tr style="background-color: #fafafa;">
                <td style="padding:10px 14px; border-bottom:1px solid #e0e0e0;">{{ container.name }}</td>
                <td style="padding:10px 14px; border-bottom:1px solid #e0e0e0;">
                    {% if not container.present %}
                        <span style="background:#fff3cd; color:#856404; padding:3px 16px; border-radius:4px; font-size:15px; font-weight:bold;">Missing</span>
                    {% elif container.state == 'running' %}
                        <span style="background:#d4edda; color:#155724; padding:3px 16px; border-radius:4px; font-size:15px; font-weight:bold;">Running</span>
                    {% else %}
                        <span style="background:#f8d7da; color:#721c24; padding:3px 16px; border-radius:4px; font-size:15px; font-weight:bold;">{{ container.state | title }}</span>
                    {% endif %}
                </td>
                <td style="padding:10px 14px; border-bottom:1px solid #e0e0e0;">
                    {% if container.present and container.started_at %}
                      {{ container.started_at | to_datetime | strftime("%Y-%m-%d %H:%M:%S") }}
                    {% else %}
                      N/A
                    {% endif %}
                </td>
            </tr>
        {% endfor %}
        </tbody>
    </table>
    {% endfor %}

    <div style="margin-top:10px; padding-top:8px; color:#666; font-size:13px; text-align:left;">
        Report generated by Ansible AAP 2.5 Container Health Check Playbook<br>
        Total Hosts Checked: {{ report_data | length }}
    </div>
</div>
</body>
</html>
