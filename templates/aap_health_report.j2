<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ report_title }}</title>
</head>
<body style="font-family: Arial, sans-serif; margin:0; padding: 0; background:#f5f5f5;">
<div style="max-width:980px; margin:32px auto; background:white; border-radius:12px; padding: 28px 32px;">

  <!-- HEADER -->
  <div style="text-align:center; color:#222;">
    <h1 style="font-size:2.3em; font-weight:700; margin-bottom:7px; margin-top:3px;">{{ report_title }}</h1>
    <div style="font-size: 1.05em; margin-bottom:18px; color:#555;">
      Generated on: Tuesday, July 22, 2025, 11:14 AM IST
    </div>
  </div>
  <hr style="border:none; border-top:2px solid #eee; margin:26px 0 18px 0;">

  <!-- SUMMARY CARDS, email-safe -->
  <table role="presentation" cellpadding="0" cellspacing="0" width="100%" style="margin-bottom:32px;">
    <tr>
      <td align="center" style="width:20%;">
        <div style="background:#28a745; color:white; border-radius:8px; padding:16px 0 10px 0; margin:0 6px;">
          <div style="font-size:2.1em; font-weight:bold; margin-bottom:4px;">
            {{ report_data | selectattr('status', 'equalto', 'HEALTHY') | list | length }}
          </div>
          <div style="font-size:1em;">Healthy Hosts</div>
        </div>
      </td>
      <td align="center" style="width:20%;">
        <div style="background:#dc3545; color:white; border-radius:8px; padding:16px 0 10px 0; margin:0 6px;">
          <div style="font-size:2.1em; font-weight:bold; margin-bottom:4px;">
            {{ report_data | selectattr('status', 'equalto', 'CRITICAL') | list | length }}
          </div>
          <div style="font-size:1em;">Critical Hosts</div>
        </div>
      </td>
      <td align="center" style="width:20%;">
        <div style="background:#17a2b8; color:white; border-radius:8px; padding:16px 0 10px 0; margin:0 6px;">
          <div style="font-size:2.1em; font-weight:bold; margin-bottom:4px;">
            {{ report_data | map(attribute='healthy_containers') | list | flatten | length }}
          </div>
          <div style="font-size:1em;">Running Containers</div>
        </div>
      </td>
      <td align="center" style="width:20%;">
        <div style="background:#ffc107; color:#212529; border-radius:8px; padding:16px 0 10px 0; margin:0 6px;">
          <div style="font-size:2.1em; font-weight:bold; margin-bottom:4px;">
          {{
            (report_data | map(attribute='down_containers') | list | flatten | length)
            + (report_data | map(attribute='missing_containers') | list | flatten | length)
          }}</div>
          <div style="font-size:1em;">Problem Containers</div>
        </div>
      </td>
    </tr>
  </table>

  {% for host_data in report_data | sort(attribute='status', reverse=true) %}
    {% set banner_bg = '#28a745' if host_data.status == 'HEALTHY' else '#dc3545' %}
    <div style="margin-bottom: 32px; border-radius:8px; overflow:hidden;">
      <div style="font-weight:bold; color:white; background:{{ banner_bg }};
        font-size:1.1em; padding:12px 18px 12px 18px;">
        <span>{{ host_data.host.upper() }}</span>
        <span style="float:right;">{{ host_data.component_type | title }} - {{ host_data.status }}</span>
      </div>
      <table width="100%" cellpadding="0" cellspacing="0" style="border-collapse:collapse; background:white;">
        <thead>
          <tr style="background:#f8f9fa;">
            <th align="left" style="padding:12px 10px; font-size:1em; font-weight:bold; border-bottom:2px solid #e0e0e0;">
              Container Name
            </th>
            <th align="left" style="padding:12px 10px; font-size:1em; font-weight:bold; border-bottom:2px solid #e0e0e0;">
              Status
            </th>
            <th align="left" style="padding:12px 10px; font-size:1em; font-weight:bold; border-bottom:2px solid #e0e0e0;">
              Start Time
            </th>
          </tr>
        </thead>
        <tbody>
          {% for container in host_data.containers %}
          <tr style="background-color: #fff;">
            <td style="padding:9px 10px; border-bottom:1px solid #e0e0e0;">{{ container.name }}</td>
            <td style="padding:9px 10px; border-bottom:1px solid #e0e0e0;">
              {% if not container.present %}
                <span style="background:#fff3cd; color:#856404; padding:2px 14px; border-radius:6px; font-size:1em; font-weight:600;">
                  Missing
                </span>
              {% elif container.state == 'running' %}
                <span style="background:#d4edda; color:#155724; padding:2px 14px; border-radius:6px; font-size:1em; font-weight:600;">
                  Running
                </span>
              {% else %}
                <span style="background:#f8d7da; color:#721c24; padding:2px 14px; border-radius:6px; font-size:1em; font-weight:600;">
                  {{ container.state | title }}
                </span>
              {% endif %}
            </td>
            <td style="padding:9px 10px; border-bottom:1px solid #e0e0e0;">
              {% if container.present and container.started_at %}
                {{ container.started_at | to_datetime | strftime("%Y-%m-%d %H:%M:%S") }}
              {% else %}
                N/A
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% endfor %}

  <div style="padding-top:18px; color:#666; font-size:12px; text-align:left;">
      Report generated by Ansible AAP 2.5 Container Health Check Playbook<br>
      Total Hosts Checked: {{ report_data | length }}
  </div>
</div>
</body>
</html>
